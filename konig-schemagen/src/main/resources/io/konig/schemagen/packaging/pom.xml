<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>${mavenProject.groupId}</groupId>
  <artifactId>${mavenProject.artifactId}</artifactId>
  <version>${mavenProject.version}</version>
  <name>${mavenProject.name}</name>
  
 
  <build>
    <plugins>
      <plugin>
        <artifactId>maven-assembly-plugin</artifactId>
        <version>2.5.3</version>
        <executions>
#foreach( $assembly in $assemblyList )        
          <execution>
            <id>${assembly.pom.id}</id>
            <phase>package</phase>
            <goals>
              <goal>single</goal>
            </goals>
            <configuration>
              <descriptors>
                <descriptor>${assembly.pom.descriptor}</descriptor>
              </descriptors>
            </configuration>
          </execution>
#end          
        </executions>
      </plugin>   
      <plugin>
				<artifactId>maven-jar-plugin</artifactId>
				<version>2.3.1</version>
				<executions>
					<execution>
						<id>default-jar</id>
						<!-- put the default-jar in the none phase to skip it from being created -->
						<phase>none</phase>
					</execution>
				</executions>
			</plugin>      
    </plugins>
  </build>
  	<profiles>
	<profile>
		<id>deploy-all</id>
		<build>
			<plugins>
				<plugin>
					<groupId>org.codehaus.mojo</groupId>
					<artifactId>exec-maven-plugin</artifactId>
					<version>1.6.0</version>
					<executions>
						<execution>
							<id>deploy gcp</id>
							<goals>
								<goal>exec</goal>
							</goals>
							<configuration>
								<executable>gcloud</executable>
								<arguments>
									<argument>deployment-manager</argument>
									<argument>deployments</argument>
									<argument>create</argument>
									<argument>${mavenProject.name}</argument>
									<argument>--config=../generated/gcp/deployment/config.yaml</argument>
								</arguments>
							</configuration>
						</execution>
						<execution>
							<id>install beam</id>
							<goals>
								<goal>exec</goal>
							</goals>
						</execution>
					</executions>
					<configuration>
						<executable>mvn </executable>
						<arguments>
							<argument>install</argument>
							<argument>exec:java</argument>
							<argument>-Pdataflow-runner</argument>
							<argument>-f</argument>
							<argument>../generated/beam/pom.xml</argument>
							<argument>-DenvironmentName=${environmentName}</argument>
						</arguments>
					</configuration>
				</plugin>
			</plugins>
		</build>
	</profile>
</profiles>
</project>